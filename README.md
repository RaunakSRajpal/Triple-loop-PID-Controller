# Triple-loop-PID-Controller
This project is a real-life implementation of the research paper [Motor control application based on STM32 and PID control theory by Zhao Zhetuo, HKUST](https://github.com/RaunakSRajpal/Triple-loop-PID-Controller/blob/main/PID-STM.pdf) on an Arduino UNO.

The objective of the project is to precisely control the rotation angle and rotational speed of a DC brush motor, which is provided by a potentiometer. The developed board should be able to toggle between speed controller configuration and angle controller configuration.

## Control Algorithm
The control law is based on 3 cascaded PID (Proportional Integral Derivative) control loops, regulating individually over the **driver current**, **angular speed (rpm)** of the motor, and the **rotation angle** of the motor.

The innermost PID loop controlling the motor current, and the outermost loop controlling the theta.

![alt text](https://github.com/RaunakSRajpal/Triple-loop-PID-Controller/blob/main/img/control%20law.png "Control Law")[^1]

### TVP
Trapezoidal velocity profile (TVP) generation has been used for getting the __*setpoint angular speed*__ (rpm). The TVP is generated by the following equations[^2]:

![alt text](https://github.com/RaunakSRajpal/Triple-loop-PID-Controller/blob/main/img/TVP.png "Trapezoidal and Triangular velocity profiles")[^2]

>$$ t_{acc,∆} = \sqrt{θ_{m}^{*}/a} $$
>
>$$ t_{acc,traz} = ω_{max}/a $$
>
>$$ T = t_{const} + t_{acc,traz} $$

where,

$a$ is the _maximum constant acceleration_, $ω_{max}$ is the _maximum angular velocity_ during the profile, $θ_{m}^{*}$ is the _desired endpoint angle_, $t_{acc,∆}$ and $t_{acc,traz}$ are the _time of constant acceleration_ for triangular and trapezoidal profils respectively, and $t_{const}$ is the _time of constant velocity_.

## Results
The following _angular speed_ response is observed from the system. The blue plot indicates the *desired values* and the red plot indicate the *physical values*. The two horizontal extreme lines reprent the maximum possible values of the angular velocity. The ripples produced are within a 5% error margin.

![alt text](https://github.com/RaunakSRajpal/Triple-loop-PID-Controller/blob/main/img/response%20curve.png "Angular Speed response curve under the control law")

The _angle_ response was quite unsatisfactory. Since the system is highly jittery and the encoder cpr (counts per revolution) very low (4x4 = 16), the control response only makes the system more unstable.

![alt text](https://github.com/RaunakSRajpal/Triple-loop-PID-Controller/blob/main/img/angle%20response.png "Angle response curve under the control law")

## References:
[^1]: Zhao, Z.T., 2013. Motor Control Application Based on STM32 and PID Control Theory. AMM 385–386, 867–871. https://doi.org/10.4028/www.scientific.net/amm.385-386.867
[^2]: Heo, Hong-Jun, Yungdeug Son, and Jang-Mok Kim. 2019. "A Trapezoidal Velocity Profile Generator for Position Control Using a Feedback Strategy" Energies 12, no. 7: 1222. https://doi.org/10.3390/en12071222
